## Выборка всех данных из таблицы

Оператор языка SQL **SELECT** - основная строительная конструкция для создания любого, простого или сложного запроса к базе данных. 

Без него, как и без фундамента для постройки, невозможно получить ни одну выборку данных из базы.


Запрос с оператором SELECT для выбора **всех** столбцов таблицы имеет следующий синтаксис:

```SQL
SELECT * FROM имя_таблицы;  /*для выбора всех столбцов таблицы после слова SELECT нужно ставить звёздочку*/
```

Используется SQL запрос следующей структуры: 
- ключевое слово SELECT; 
- символ « *» ; 
- ключевое слово FROM; 
- имя таблицы.

Результатом является таблица, в которую включены все строки и столбцы указанной в запросе таблицы.


**Пример**

Выбрать все записи таблицы **book**.

*Запрос*:

```SQL
SELECT * FROM book;             /* вывести всю информацию из таблицы book */
```

*Результат*:

[![6.png](https://i.postimg.cc/50NVMBzg/6.png)](https://postimg.cc/WDKKGJXq)

___
## Выборка отдельных столбцов

Для выбора определённых столбцов таблицы нам потребуется вместо звёздочки перечислить через запятую **названия всех столбцов, которые требуется выбрать**:

```SQL
SELECT выбираемые_столбцы FROM имя_таблицы;
```

Используется SQL запрос следующей структуры: 

- ключевое слово SELECT ; 
- список столбцов таблицы через запятую; 
- ключевое слово FROM ; 
- имя таблицы.


Результатом является таблица, в которую включены все данные из указанных после SELECT столбцов исходной таблицы.


**Пример**

Выбрать названия книг и их количества из таблицы **book** .

*Запрос*:

```SQL
SELECT title, amount FROM book;           /*выбрать title, amount из таблицы book*/
```

*Результат*:

|title                  | amount |
|-----------------------|--------| 
| Мастер и Маргарита    | 3      | 
| Белая гвардия         | 5      | 
| Идиот                 | 10     | 
| Братья Карамазовы     | 2      | 
| Стихотворения и поэмы | 15     |

Affected rows: 5
___
## Присвоение новых имен столбцам при формировании выборки

С помощью оператора **AS** можно отобрать данные из определенных столбцов таблицы и одновременно задать столбцам новые названия (псевдонимы) в результате выборки:

```SQL
SELECT выбираемый_столбец AS псевдоним
FROM имя_таблицы;
```

Используется SQL запрос следующей структуры: 

* ключевое слово SELECT ; 
* имя столбца;
* ключевое слово AS ; 
* новое название столбца (можно русскими буквами), выводимое в результате запроса, но это должно быть одно слово, если название состоит из двух слов – соединяйте их подчеркиванием, например, Количество_книг; 
* запятая; 
* имя столбца; 
.... 
* ключевое слово FROM ; 
* имя таблицы.


В одном запросе можно использовать и имена столбцов из таблицы, и новые названия.

Результатом является таблица, в которую включены все данные из указанных после SELECT столбцов исходной таблицы. Каждому столбцу в результате запроса присваивается новое имя, заданное после AS, или столбец получает имя столбца исходной таблицы, если AS отсутствует.


**Пример**

Выбрать все названия книг и их количество из таблицы **book** , для столбца **title** задать новое имя **Название**.

*Запрос*:

```SQL 
SELECT title AS Название, amount                /*выбрать title как Название, amount из таблицы book*/
FROM book;
```

*Результат*:

| Название              | amount |
|-----------------------|--------| 
| Мастер и Маргарита    | 3      |
| Белая гвардия         | 5      | 
| Идиот                 | 10     |
| Братья Карамазовы     | 2      |
| Стихотворения и поэмы | 15     |

Affected rows: 5
___
## Выборка данных с созданием вычисляемого столбца

С помощью SQL запросов можно осуществлять вычисления по каждой строке таблицы с помощью вычисляемого столбца. Для него в списке полей после оператора **SELECT** указывается выражение и задается имя.

Выражение может включать имена столбцов, константы, знаки операций, встроенные функции.

Результатом является таблица, в которую включены все данные из указанных после **SELECT** столбцов, а также новый столбец, в каждой строке которого вычисляется заданное выражение.


**Пример**

Вывести всю информацию о книгах, а также для каждой позиции посчитать ее **стоимость** (произведение цены на количество). Вычисляемому столбцу дать имя **total**.


*Запрос*:

```SQL
SELECT title, author, price, amount,      /*выбрать title, author, price, amount,*/
       price * amount AS total            /*произведение цены на количество как total*/
FROM book;                                /*из таблицы bool*/
```

*Результат*: 


| title                 | author           | price  | amount | total   | 
|-----------------------|------------------|--------|--------|---------| 
| Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      | 2012.97 | 
| Белая гвардия         | Булгаков М.А.    | 540.50 | 5      | 2702.50 | 
| Идиот                 | Достоевский Ф.М. | 460.00 | 10     | 4600.00 | 
| Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 2      | 1598.02 | 
| Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     | 9750.00 |

Affected rows: 5
___
## Выборка данных, вычисляемые столбцы, математические функции
В SQL реализовано множество  [математических функций](https://learn.microsoft.com/ru-ru/sql/t-sql/functions/mathematical-functions-transact-sql?view=sql-server-ver15) для работы с числовыми данными. В таблице приведены некоторые из них.

[![7.png](https://i.postimg.cc/kGvbFYR9/7.png)](https://postimg.cc/rRzsqJ9Y)

**Пояснение.**   Существуют разные способы округления чисел. В SQL реализовано математическое округление. Для округления вещественного числа нужно в записи числа выбрать разряд в дробной части, до которого производится округление. Цифра, записанная в выбранном разряде: не меняется, если следующая за ней справа цифра - 0, 1, 2, 3 или 4; увеличивается на единицу, если следующая за ней справа цифра - 5,6,7,8 или 9.


**Пример** 

Для каждой книги из таблицы **book** вычислим налог на добавленную стоимость (имя столбца **tax**) , который включен в цену и составляет k = 18%,  а также цену книги (**price_tax**) без него. Формулы для вычисления:

[![8.png](https://i.postimg.cc/Vs4fccw1/8.png)](https://postimg.cc/WtFLMCtf)

Эта формула НДС отвечает на вопрос "Какую сумму увеличили на 18%, чтобы получить текущее значение"


*Запрос*:

```SQL
SELECT title, price, 
       (price*18/100)/(1+18/100) AS tax, 
       price/(1+18/100) AS price_tax 
FROM book;
```

*Результат*:


| title                 | price  | tax            | price_tax  |
|-----------------------|--------|----------------|------------|
| Мастер и Маргарита    | 670.99 | 102.3544067797 | 568.635593 |
| Белая гвардия         | 540.50 | 82.4491525424  | 458.050847 |
| Идиот                 | 460.00 | 70.1694915254  | 389.830508 |
| Братья Карамазовы     | 799.01 | 121.8828813559 | 677.127119 |
| Стихотворения и поэмы | 650.00 | 99.1525423729  | 550.847458 |

Affected rows: 5


Сумма налога и цена книги без налога – это деньги, поэтому количество знаков после запятой у этих чисел должно быть 2. Следовательно необходимо округлить полученные значения.


*Запрос*:

```SQL
SELECT title, 
       price, 
       ROUND((price*18/100)/(1+18/100),2) AS tax, 
       ROUND(price/(1+18/100),2) AS price_tax 
FROM book;
```

*Результат*:

| title                 | price  | tax    | price_tax |
|-----------------------|--------|--------|-----------|
| Мастер и Маргарита    | 670.99 | 102.35 | 568.64    |
| Белая гвардия         | 540.50 | 82.45  | 458.05    |
| Идиот                 | 460.00 | 70.17  | 389.83    |
| Братья Карамазовы     | 799.01 | 121.88 | 677.13    |
| Стихотворения и поэмы | 650.00 | 99.15  | 550.85    |

Affected rows: 5

___
## Выборка данных, вычисляемые столбцы, логические функции

В SQL реализована возможность заносить в поле значение в зависимости от условия. Для этого используется функция **IF()**:

**IF(логическое_выражение, выражение_1, выражение_2)**

Функция вычисляет логическое_выражение, если оно **истина** – в поле заносится значение **выражения_1**, в противном случае –  значение **выражения_2**. Все три параметра **IF()** являются обязательными.

Допускается использование вложенных функций, вместо **выражения_1** или **выражения_2** может стоять новая **функция IF**.


**Пример**: 

Для каждой книги из таблицы **book** установим скидку следующим образом: если количество книг **меньше 4**, то скидка будет составлять **50% от цены**, в противном случае - **30%**.

*Запрос*:

```SQL
SELECT title, amount, price,                          /*выбрать title, amount, price*/
       IF(amount < 4, price*0.5, price*0.7) AS sale   /*если amount < 4, умножить цену на 0.5, иначе - умножить цену на 0.5*/
FROM book;                                            /*из таблицы book*/
```


*Результат*:

| title                 | amount | price  | sale    |
|-----------------------|--------|--------|---------|
| Мастер и Маргарита    | 3      | 670.99 | 335.495 |
| Белая гвардия         | 5      | 540.50 | 378.350 |
| Идиот                 | 10     | 460.00 | 322.000 |
| Братья Карамазовы     | 2      | 799.01 | 399.505 |
| Стихотворения и поэмы | 15     | 650.00 | 455.000 |

Affected rows: 5


Цена по скидке должна отображаться с двумя знаками после запятой, добавим в запрос округление:

```SQL
SELECT title, amount, price,                                    /*выбрать title, amount, price*/
       ROUND(IF(amount < 4, price*0.5, price*0.7), 2) AS sale   /*округлить результат в скобках, оставить 2 знака после запятой*/
FROM book;                                                      /*из таблицы book*/
```


*Результат*:

| title                 | amount | price  | sale   |
|-----------------------|--------|--------|--------|
| Мастер и Маргарита    | 3      | 670.99 | 335.50 |
| Белая гвардия         | 5      | 540.50 | 378.35 |
| Идиот                 | 10     | 460.00 | 322.00 |
| Братья Карамазовы     | 2      | 799.01 | 399.51 |
| Стихотворения и поэмы | 15     | 650.00 | 455.00 |

Affected rows: 5


**Пример**

Усложним вычисление скидки в зависимости от количества книг. Если количество книг меньше 4 – то скидка 50%, меньше 11 – 30%, в остальных случаях – 10%. И еще укажем **какая именно** скидка на каждую книгу.


*Запрос*:

```SQL
SELECT title, amount, price,                                                                      /*выбрать title, amount, price*/
       ROUND(IF(amount < 4, price * 0.5, IF(amount < 11, price * 0.7, price * 0.9)), 2) AS sale,  /*в этой строке мы вычисляем, округляем скидку и прописываем название столбца*/
       IF(amount < 4, 'скидка 50%',                                                               /*в этой строке формируем новый столбец с указанием размера скидки*/
          IF(amount < 11, 'скидка 30%', 'скидка 10%')) AS Ваша_скидка
FROM book;                                                                                        /*Из таблицы book*/
```

**Пояснение к вычислениям скидки**:
- Если количество книг (amount) < 4, применяем скидку 50%, соответственно price * 0.5
- Далее часть "иначе" делится на два сценария:
  * если количество книг (amount) < 11, применяем скидку 30%, соответственно price * 0.7
  * иначе - применяем скидку 10%, соответственно price * 0.9
- округляем полученный результат до 2-х знаков после запятой с помощью оператора ROUND(), не забываем посчитать все скобки
- присваиваем с помощью оператора AS название столбцу - sale

**Пояснение к новому столбцу со скидками**:
- Нам нужно в результируещей таблице получить 5 столбцов:
  * title, amount, price мы просто перечисляем как есть через запятую
  * далее через запятую указываем новый столбец **sale**, который у нас получается с помощью оператора IF() и вычислений
  * и также нам надо через запятую указать новый столбец **Ваша_скидка**, который тоже получим с использованием оператора IF()
- Если количество книг (amount) < 4, пишем в результат - 'скидка 50%', иначе снова проверяем:
  * если если количество книг (amount) < 11, пишем 'скидка 30%'
  * иначе - пишем 'скидка 10%'
- Присваиваем новому столбцу название Ваша_скидка (название столбцов, а также таблиц и баз данных пишется без кавычек)


*Результат*:

| title                 | amount | price  | sale   | Ваша_скидка |
|-----------------------|--------|--------|--------|-------------|
| Мастер и Маргарита    | 3      | 670.99 | 335.50 | скидка 50%  |
| Белая гвардия         | 5      | 540.50 | 378.35 | скидка 30%  |
| Идиот                 | 10     | 460.00 | 322.00 | скидка 30%  |
| Братья Карамазовы     | 2      | 799.01 | 399.51 | скидка 50%  |
| Стихотворения и поэмы | 15     | 650.00 | 585.00 | скидка 10%  |

Affected rows: 5
