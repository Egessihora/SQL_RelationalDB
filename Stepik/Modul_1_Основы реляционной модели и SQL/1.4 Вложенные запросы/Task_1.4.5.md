## TASK 1.4.5 [задание на stepik](https://stepik.org/lesson/297514/step/5?unit=279274)
Вывести информацию о книгах (автор, название, цена), цена которых меньше самой большой из минимальных цен, вычисленных для каждого автора.

**Решение:**

```SQL
SELECT author, title, price
FROM book
WHERE price < ANY (
    SELECT MIN(price)
    FROM book
    GROUP BY author
);
```

**Перевод на человеческий:**

```SQL
/*выбери столбцы author, title, price*/
/*из таблицы book*/
/*выбери только те строки, в которых значение столбца price меньше хотя бы одного значения из списка результатов вложенного запроса*/
/*во вложенном запросе выбери минимальную значение столбца price по каждому автору из таблицы book, сгруппируй по столбцу author*/
```

**Результат:**

```SQL
+------------------+---------------+--------+
| author           | title         | price  |
+------------------+---------------+--------+
| Булгаков М.А.    | Белая гвардия | 540.50 |
| Достоевский Ф.М. | Идиот         | 460.00 |
| Достоевский Ф.М. | Игрок         | 480.50 |
+------------------+---------------+--------+
Affected rows: 3
```

**Пояснения:**

1. Для решения этой задачи необходимо сравнить значения столбца **price** основной таблицы **book** со значениями отдельной выборки минимальных цен
по каждому автору. Эту выборку делаем во вложенном запросе.

2. Сначала разберём вложенный запрос.
Соберём в группы значения столбца **author** с помощью оператора ```GROUP BY```:
  
```SQL
SELECT author
FROM book
GROUP BY author;
```

Получим 3 группы авторов:
- Булгаков М.А.
- Достоевский Ф.М.
- Есенин С.А.

```SQL
+------------------+
| author           |
+------------------+
| Булгаков М.А.    |
| Достоевский Ф.М. |
| Есенин С.А.      |
+------------------+
```

Теперь к этим группам можно применить агрегирующие функции. В нашем случае мы вычислим минимальное значение **price** в каждой группе
с помощью функции ```MIN```.

```SQL
SELECT author, MIN(price)
FROM book
GROUP BY author;
```

Получим промежуточную таблицу с результатом вычисления (столбец ```author``` выведен для наглядности):

```SQL
+------------------+------------+
| author           | MIN(price) |
+------------------+------------+
| Булгаков М.А.    | 540.50     |
| Достоевский Ф.М. | 460.00     |
| Есенин С.А.      | 650.00     |
+------------------+------------+
```

3. Можно перейти к **основному** запросу. У нас сейчас есть:

Основная таблица **book**:

```SQL
+---------+-----------------------+------------------+--------+--------+
| book_id | title                 | author           | price  | amount |
+---------+-----------------------+------------------+--------+--------+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     |
+---------+-----------------------+------------------+--------+--------+
```

и список значений **```MIN(price)```** в результате вложенного запроса: **(540.50, 460.00, 650.00)**

Осталось вывести окончательную результирующую таблицу. Для этого с помощью оператора ```WHERE``` построчно проходимся (сервер проходится) по основной 
таблице **book** и с помощью оператора ```ANY``` сопоставляем: если значение **price** в таблице **book** меньше хотя бы одного значения 
(равносильно "меньше самого большого") из списка результатов вложенного запроса, то добавляем такую строку в результирующую таблицу: 

```price < ANY (SELECT MIN(price) FROM book GROUP BY author)``` >>> ```price < ANY (540.50, 460.00, 650.00)``` >>> ```price < (650.00)```

Получаем **итоговый** результат:

```SQL
+------------------+---------------+--------+
| author           | title         | price  |
+------------------+---------------+--------+
| Булгаков М.А.    | Белая гвардия | 540.50 |
| Достоевский Ф.М. | Идиот         | 460.00 |
| Достоевский Ф.М. | Игрок         | 480.50 |
+------------------+---------------+--------+
Affected rows: 3
```
