## TASK 1.4.3 [задание на stepik](https://stepik.org/lesson/297514/step/3?unit=279274)
Вывести информацию (автора, название и цену) о тех книгах, цены которых превышают минимальную цену книги на складе 
не более чем на 150 рублей в отсортированном по возрастанию цены виде.

**Решение:**

```SQL
SELECT author, title, price          /*выбери столбцы author, title, price*/
FROM book                            /*из таблицы book*/
WHERE price -                        /*выбери только те строки, в которых разница между ценой и результатом вложенного запроса меньше или равна 150*/
      (
      SELECT MIN(price)              /*высли минимальное значение в столбце price*/
      FROM book                      /*из таблицы book*/
      ) <= 150
ORDER BY price;                      /*отсортируй по столбцу price*/
```

**Результат:**

```SQL
+------------------+----------------+--------+
| author           | title          | price  |
+------------------+----------------+--------+
| Достоевский Ф.М. | Идиот          | 460.00 |
| Достоевский Ф.М. | Игрок          | 480.50 |
| Булгаков М.А.    | Белая гвардия  | 540.50 |
| Пушкин А.С.      | Евгений Онегин | 610.00 |
+------------------+----------------+--------+
Affected rows: 4
```

**Пояснения:**

1. В данном запросе мы должны проверить в каждой строке выполнение условия и в результирующую таблицу взять только те строки, которые будут
удовлетворять поставленному условию. Условие у нас следующее:  цена **превышает** минимальную цену **не более чем** на 150 рублей.

2. Для того, чтобы это проверить сначала надо сделать вложенный запрос, который нам вычислит значение минимальной цены, с помощью оператора ```MIN```.
   Вложенный запрос мы пишем также как обычный запрос с тем же синтаксисом, только заключаем его в скобки, не ставим в конце этого запроса точку с запятой
   и размещаем его на месте, в котором по логике предложения должно быть значение (результат вложенного запроса) для дальнейших вычислений.

*Временная таблица (условная) после с результатом вложенного запроса:*
 
```SQL
+---------+-----------------------+------------------+--------+--------+------------+
| book_id | title                 | author           | price  | amount | MIN(price) |
+---------+-----------------------+------------------+--------+--------+------------+
| 1       | Мастер и Маргарита    | Булгаков М.А.    | 670.99 | 3      | 460.00     |
| 2       | Белая гвардия         | Булгаков М.А.    | 540.50 | 5      | 460.00     |
| 3       | Идиот                 | Достоевский Ф.М. | 460.00 | 10     | 460.00     |
| 4       | Братья Карамазовы     | Достоевский Ф.М. | 799.01 | 3      | 460.00     |
| 5       | Игрок                 | Достоевский Ф.М. | 480.50 | 10     | 460.00     |
| 6       | Стихотворения и поэмы | Есенин С.А.      | 650.00 | 15     | 460.00     |
+---------+-----------------------+------------------+--------+--------+------------+
```
3. Теперь можно производить вычисления, так как есть нужное значение. Ещё раз вернёмся к условию. Что означает: "цена **превышает** минимальную цену
**не более чем** на 150 рублей"?
- Во-первых, для понимания превышения нам нужно вычислить разницу между ценой в строке и минимальным значением цены в столбце. Это значит, что нам нужно
     выполнить вычисление выражения ```price - (SELECT MIN(price) FROM book)``` >>> ```price - 460.00```
- Во-вторых, понять какие строки нужно включать в результат по нашему условию. Трактуется условие так: цена **не должна превышать
     более чем на 150** минимальную цену (```MIN(price)```). А это означает, что полученная разница может как быть **меньше**, так и быть **равной** 150,
     но **не быть больше** 150.

*Временная таблица (условная) после с результатом вложенного запроса и результатом вычитания:*

```SQL
+------------------+-----------------------+--------+------------+--------------------+
| author           | title                 | price  | MIN(price) | price - MIN(price) |
+------------------+-----------------------+--------+------------+--------------------+
| Булгаков М.А.    | Мастер и Маргарита    | 670.99 | 460.00     | 210.99             |
| Булгаков М.А.    | Белая гвардия         | 540.50 | 460.00     | 80.50              |
| Достоевский Ф.М. | Идиот                 | 460.00 | 460.00     | 0.00               |
| Достоевский Ф.М. | Братья Карамазовы     | 799.01 | 460.00     | 339.01             |
| Достоевский Ф.М. | Игрок                 | 480.50 | 460.00     | 20.50              |
| Есенин С.А.      | Стихотворения и поэмы | 650.00 | 460.00     | 190.00             |
| Пушкин А.С.      | Евгений Онегин        | 610.00 | 460.00     | 150.00             |
+------------------+-----------------------+--------+------------+--------------------+
```

4. Далее сервер сравнивает строки с условием и в результирующую выборку включает только строки, удовлетворяющие условию:

```SQL
+------------------+----------------+--------+
| author           | title          | price  |
+------------------+----------------+--------+
| Булгаков М.А.    | Белая гвардия  | 540.50 |
| Достоевский Ф.М. | Идиот          | 460.00 |
| Достоевский Ф.М. | Игрок          | 480.50 |
| Пушкин А.С.      | Евгений Онегин | 610.00 |
+------------------+----------------+--------+
```

5. Осталось отсортировать строки с помощью оператора ```ORDER BY```. Сортировку надо сделать по возрастанию цены, поэтому для сортировки используем столбец
**price** и ключевое слово ```ASC``` или ничего не писать, так как оно установлено по умолчанию.

В результате всего запроса

``````SQL
SELECT author, title, price          
FROM book                           
WHERE price -                        
      (
      SELECT MIN(price)              
      FROM book                     
      ) <= 150
ORDER BY price;                     
```

сервер покажет нам результирующую таблицу:

```SQL
+------------------+----------------+--------+
| author           | title          | price  |
+------------------+----------------+--------+
| Достоевский Ф.М. | Идиот          | 460.00 |
| Достоевский Ф.М. | Игрок          | 480.50 |
| Булгаков М.А.    | Белая гвардия  | 540.50 |
| Пушкин А.С.      | Евгений Онегин | 610.00 |
+------------------+----------------+--------+
Affected rows: 4
```
